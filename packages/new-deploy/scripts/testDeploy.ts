import DeployContext from '../src/DeployContext';
// import * as sdk from '@nomad-xyz/sdk';
import * as config from '@nomad-xyz/configuration';
import * as ethers from 'ethers';
import { NonceManager } from '@ethersproject/experimental';
import fs from "fs";

// docker run -d -e "BLOCK_TIME=1000" -e "PRIVATE_KEY1=1000000000000000000000000000000000000000000000000000000000000001" -e "PRIVATE_KEY2=2000000000000000000000000000000000000000000000000000000000000002" -e "PRIVATE_KEY3=3000000000000000000000000000000000000000000000000000000000000003" -e "PRIVATE_KEY4=4000000000000000000000000000000000000000000000000000000000000004" -e "PRIVATE_KEY5=5000000000000000000000000000000000000000000000000000000000000005" -e "PRIVATE_KEY6=6000000000000000000000000000000000000000000000000000000000000006" -e "PRIVATE_KEY7=7000000000000000000000000000000000000000000000000000000000000007" -e "PRIVATE_KEY8=8000000000000000000000000000000000000000000000000000000000000008" -p 8545:8545 --name tom hardhat
// docker run -d -e "BLOCK_TIME=1000" -e "PRIVATE_KEY1=1000000000000000000000000000000000000000000000000000000000000001" -e "PRIVATE_KEY2=2000000000000000000000000000000000000000000000000000000000000002" -e "PRIVATE_KEY3=3000000000000000000000000000000000000000000000000000000000000003" -e "PRIVATE_KEY4=4000000000000000000000000000000000000000000000000000000000000004" -e "PRIVATE_KEY5=5000000000000000000000000000000000000000000000000000000000000005" -e "PRIVATE_KEY6=6000000000000000000000000000000000000000000000000000000000000006" -e "PRIVATE_KEY7=7000000000000000000000000000000000000000000000000000000000000007" -e "PRIVATE_KEY8=8000000000000000000000000000000000000000000000000000000000000008" -p 8546:8545 --name jerry hardhat

(async () => {
    let config: config.NomadConfig = JSON.parse(fs.readFileSync(`./scripts/config.json`, 'utf8'));

    let c = new DeployContext(config);

    let st = new ethers.Wallet('1000000000000000000000000000000000000000000000000000000000000001', new ethers.providers.JsonRpcProvider(c.data.rpcs['tom'][0]));
    let sj = new ethers.Wallet('2000000000000000000000000000000000000000000000000000000000000002', new ethers.providers.JsonRpcProvider(c.data.rpcs['jerry'][0]));
    c.registerSigner('tom', new NonceManager(st));
    c.registerSigner('jerry', new NonceManager(sj));
    
    const overrides = {
        // gasPrice: '16500000160',
        maxFeePerGas: '121000000000',
        // maxPriorityFeePerGas: '10000000000'
    };
    c.overrides.set('tom', overrides);
    c.overrides.set('jerry', overrides);

    await c.ensureConnections();
    // x[0]?.
    // fs.writeFileSync(`./scripts/data.json`, JSON.stringify(c.data, null, 4));

    await c.checkCores();
    await c.checkBridges();

})();